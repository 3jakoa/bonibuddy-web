<!doctype html>
<html lang="sl">
<head>
  <meta charset="utf-8">
  <title>BoniBuddy ‚Ä¢ Zakljuƒçeno</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root{
      --bg: #F6FBFE;
      --card: #ffffff;
      --card2: #ffffff;
      --text: #111111;
      --muted: #5F6F7A;
      --disabled: #9ca3af;
      --border: rgba(0,166,246,0.18);
      --accent: #00A6F6;
      --accent-light: #92DBF3;
      --radius: 18px;
      --shadow: 0 12px 32px rgba(0,166,246,0.10);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color: var(--text);
      background: var(--bg);
      min-height: 100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:100%;
      max-width:460px;
      background: var(--card);
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:22px 20px 24px;
      backdrop-filter: blur(10px);
    }
    h1{margin:0 0 8px; font-size:22px;}
    .subtitle{color:var(--muted); font-size:14px; margin-bottom:16px;}
    .pill{display:inline-flex; align-items:center; gap:6px; padding:8px 10px; border-radius:12px; border:1px solid #92DBF3; background: #EAF7FD; font-size:12px; color:#007FBF; box-shadow: 0 6px 16px rgba(0,166,246,0.08);}
    .btn{display:block; width:100%; text-align:center; padding:14px 14px; border-radius:14px; border:1px solid var(--accent); background: var(--accent); color:#ffffff; font-weight:700; text-decoration:none; margin-top:12px; transition: background 0.2s ease; box-shadow: 0 6px 16px rgba(0,166,246,0.12);}
    .btn:hover{background:#008ed5;}
    .btn-secondary{display:block; width:100%; text-align:center; padding:12px 14px; border-radius:12px; border:1px solid var(--accent); background: #ffffff; color:var(--accent); font-weight:600; text-decoration:none; margin-top:8px; transition: background 0.2s ease, color 0.2s ease;}
    .btn-secondary:hover{background: color-mix(in srgb, var(--accent-light) 25%, #ffffff 75%); color:#005f8f;}
    .link{display:block; margin-top:12px; color:var(--accent); text-decoration:none; font-size:13px;}
    .link:hover{text-decoration:underline; color:#005f8f;}
    .preview-box{margin-top:8px; border:1px solid var(--border); background: #ffffff; border-radius:12px; padding:10px 12px; font-size:13px; color:var(--muted); line-height:1.35;}
  </style>
</head>
<body>
  <div class="card">
    {% include "_active_plan.html" %}
    {% if joined_existing %}
      <h1>Dogovorjeno ‚úÖ</h1>
      <div class="subtitle">Gre≈° v {{ restaurant.name }} ¬∑ {{ bucket_label }}</div>
      <div class="subtitle">Pridru≈æil si se: {% if primary_other %}{{ primary_other }}{% endif %}{% if other_count > 0 %} +{{ other_count }}{% endif %}</div>
      {% if primary_other %}
        <a class="btn" href="{{ instagram_url }}" target="_blank" rel="noopener">Kontaktiraj na Instagramu</a>
        <div class="subtitle" style="margin-top:10px; margin-bottom:4px;">Predlagano sporoƒçilo</div>
        <div class="preview-box">Hej! Vidim na BoniBuddy, da gre≈° jest v {{ restaurant.name }} {{ bucket_label }}. A greva skupaj? üòä</div>
        <button class="btn-secondary" id="copyDmBtn" type="button">üìã Kopiraj DM</button>
        <div class="muted" style="font-size:12px; margin-top:4px;">Prilepi v Instagram DM.</div>
      {% endif %}
    {% else %}
      <h1>Plan objavljen üëÄ</h1>
      <div class="subtitle">Gre≈° v {{ restaurant.name }} ¬∑ {{ bucket_label }}</div>
      <div class="subtitle">Zaenkrat si prvi ‚Äî povabi prijatelja ali poƒçakaj.</div>
      <button class="btn" id="shareBtn" type="button">Deli link</button>
      <button class="btn btn-secondary" id="copyInviteBtn" type="button">üìã Kopiraj vabilo</button>
    {% endif %}

    <form method="post" action="/waiting/leave" style="margin-top:14px;">
      <input type="hidden" name="restaurant_id" value="{{ restaurant.id }}">
      <input type="hidden" name="time_bucket" value="{{ bucket }}">
      <input type="hidden" name="user_id" value="{{ user_id }}">
      <button class="btn btn-secondary" type="submit">Prekliƒçi plan</button>
    </form>
    <a class="link" href="/">Nazaj na pregled</a>
  </div>
  <script>
    (function(){
      async function copyText(txt){
        try{
          await navigator.clipboard.writeText(txt);
          return true;
        }catch(e){ return false; }
      }
      const dmBtn = document.getElementById('copyDmBtn');
      if(dmBtn){
        dmBtn.addEventListener('click', async ()=>{
          const ok = await copyText("{{ copy_message_for_dm }}");
          dmBtn.textContent = ok ? "‚úÖ Kopirano" : "Ni uspelo kopirati";
          setTimeout(()=>dmBtn.textContent="üìã Kopiraj DM",1500);
        });
      }
      const inviteBtn = document.getElementById('copyInviteBtn');
      if(inviteBtn){
        inviteBtn.addEventListener('click', async ()=>{
          const ok = await copyText("{{ copy_invite_message }}");
          inviteBtn.textContent = ok ? "Skopirano ‚úì" : "Ni ≈°lo, kopiraj roƒçno";
          setTimeout(()=>inviteBtn.textContent="Kopiraj vabilo",1500);
        });
      }
      const shareBtn = document.getElementById('shareBtn');
      if(shareBtn){
        shareBtn.addEventListener('click', async ()=>{
          const url = "{{ share_url }}";
          const text = "{{ copy_invite_message }}";
          try{
            if(navigator.share){
              await navigator.share({title:"BoniBuddy", text, url});
            }else{
              await copyText(text);
              shareBtn.textContent = "Link skopiran ‚úì";
              setTimeout(()=>shareBtn.textContent="Deli link",1500);
            }
          }catch(e){
            shareBtn.textContent = "Poskusi znova";
            setTimeout(()=>shareBtn.textContent="Deli link",1500);
          }
        });
      }
    })();
  </script>
</body>
</html>
